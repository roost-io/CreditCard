# language: he
Feature: רכישת מוצר באתר המסחר האלקטרוני

  בדיקת תהליך רכישת מוצר מקצה לקצה, כולל ניווט, הוספה לסל, מילוי פרטים בקופה וטיפול בשגיאות.

  # ===================================================
  # UI Tests - בדיקות ממשק משתמש
  # ===================================================

  @ui
  Scenario: תהליך רכישה מלא עם שדות חסרים ושיטת תשלום לא תקינה
    Given אני נמצא בעמוד הבית
    When אני לוחץ על כפתור "SHOP NOW" בקטגוריית "Latest Eyewear For You"
    And אני מנווט לעמוד מוצרים מספר 2
    And אני בוחר במוצר "Red Hoodie"
    And אני מוסיף את המוצר לסל הקניות
    And אני לוחץ על כפתור "VIEW CART"
    And אני בוחר בשיטת משלוח "Local pickup"
    And אני בוחר בשיטת משלוח "Delivery Express"
    And אני בוחר בשיטת משלוח "Registered Mail"
    And אני לוחץ על כפתור "PROCEED TO CHECKOUT"
    And אני ממלא את כל פרטי החיוב למעט מיקוד
      | שדה           | ערך             |
      | First name    | ישראל          |
      | Last name     | ישראלי          |
      | Street address| הרצל 10         |
      | Town / City   | תל אביב         |
      | Phone         | 0501234567      |
      | Email address | test@test.com   |
    And אני לוחץ על כפתור "PLACE ORDER"
    Then אני אמור לראות הודעת שגיאה "Billing Postcode / ZIP is a required field."
    When אני ממלא את השדה "Postcode / ZIP" עם הערך "55555"
    And אני לוחץ שוב על כפתור "PLACE ORDER"
    Then אני אמור לראות הודעת שגיאה "Invalid payment method."

  @ui @validation
  Scenario Outline: ולידציה על שדות חובה בעמוד התשלום
    Given הוספתי את המוצר "Red Hoodie" לסל ואני נמצא בעמוד התשלום
    When אני ממלא את כל פרטי החיוב הנדרשים פרט לשדה "<field_to_omit>"
    And אני לוחץ על כפתור "PLACE ORDER"
    Then אני אמור לראות את הודעת השגיאה "<error_message>"

    Examples:
      | field_to_omit  | error_message                                     |
      | First name     | "Billing First name is a required field."         |
      | Last name      | "Billing Last name is a required field."          |
      | Street address | "Billing Street address is a required field."     |
      | Town / City    | "Billing Town / City is a required field."        |
      | Postcode / ZIP | "Billing Postcode / ZIP is a required field."     |
      | Phone          | "Billing Phone is a required field."              |
      | Email address  | "Billing Email address is a required field."      |

  # ===================================================
  # API Tests - בדיקות API
  # ===================================================

  Background:
    Given נקודת הגישה הבסיסית של ה-API היא "https://automation.future/api/v1"
    And קיים טוקן אימות (Authorization token) תקף למערכת

  @api @cart
  Scenario Outline: הוספת מוצרים שונים לסל הקניות דרך ה-API
    When אני שולח בקשת "POST" לנקודת הקצה "/cart/add-item" עם המטען הבא
      '''
      {
        "product_id": <product_id>,
        "quantity": <quantity>
      }
      '''
    Then קוד התגובה צריך להיות <response_code>
    And גוף התגובה צריך לאשר שהמוצר נוסף בהצלחה או להכיל הודעת שגיאה מתאימה

    Examples: בדיקות חיוביות
      | product_id | quantity | response_code |
      | 1497       | 1        | 200           |
      | 1497       | 5        | 200           |
      | 1501       | 2        | 200           |

    Examples: בדיקות שליליות וערכי קצה
      | product_id | quantity | response_code |
      | 1497       | 0        | 400           |
      | 1497       | -1       | 400           |
      | 99999      | 1        | 404           |
      | "abc"      | 1        | 400           |

  @api @checkout
  Scenario Outline: ניסיון ביצוע הזמנה עם נתונים חסרים דרך ה-API
    Given הוספתי מוצר לסל הקניות דרך ה-API
    When אני שולח בקשת "POST" לנקודת הקצה "/checkout" עם מטען חסר בפרט "<missing_field>"
      '''
      <payload>
      '''
    Then קוד התגובה צריך להיות 400
    And גוף התגובה צריך להכיל את הודעת השגיאה "<error_message>"

    Examples:
      | missing_field  | error_message                          | payload                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       -
      | "first_name"   | "first_name is a required field"       | {"billing": {"last_name": "ישראלי", "address_1": "הרצל 10", "city": "תל אביב", "postcode": "55555", "country": "IL", "email": "test@test.com", "phone": "0501234567"}, "payment_method": "bacs"} |
      | "postcode"     | "postcode is a required field"         | {"billing": {"first_name": "ישראל", "last_name": "ישראלי", "address_1": "הרצל 10", "city": "תל אביב", "country": "IL", "email": "test@test.com", "phone": "0501234567"}, "payment_method": "bacs"} |
      | "email"        | "email is a required field"            | {"billing": {"first_name": "ישראל", "last_name": "ישראלי", "address_1": "הרצל 10", "city": "תל אביב", "postcode": "55555", "country": "IL", "phone": "0501234567"}, "payment_method": "bacs"} |
      | "payment_method" | "Invalid payment method."            | {"billing": {"first_name": "ישראל", "last_name": "ישראלי", "address_1": "הרצל 10", "city": "תל אביב", "postcode": "55555", "country": "IL", "email": "test@test.com", "phone": "0501234567"}, "payment_method": "invalid_method"} |
